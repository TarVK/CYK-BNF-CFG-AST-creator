!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.library=e():t.library=e()}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);var n=function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},a=function(){function t(t,e){this.grammar=t,this.startSymbol=e,this.lookupTable=this.createLookupTable(t)}return t.prototype.createLookupTable=function(t){var e={};return Object.keys(t).forEach((function(r){t[r].forEach((function(t){e[t.left]||(e[t.left]={});var a=e[t.left];a[t.right]||(a[t.right]=[]),a[t.right].push(n(n({},t),{defSymbol:r}))}))})),e},t.prototype.performCYK=function(t,e){for(var r=[],a=0;a<t.length;a++)r[a]=[];for(var o=0;o<t.length;o++){var i=function(e){var a=r[e][o]={symbols:[],definitions:[],range:{start:null,end:null}};if(e==o){var i=t[e].symbol;a.symbols.push(i);var l=u.lookupTable[i];l&&l[void 0]&&l[void 0].forEach((function(t){a.symbols.includes(t.defSymbol)||a.symbols.push(t.defSymbol),a.definitions.push(n({index:e},t))})),a.range=t[e].range}else a.range.start=r[e][e].range.start,a.range.end=r[o][o].range.end},u=this;for(a=o;a>=0;a--)i(a)}for(o=1;o<t.length;o++)for(a=o-1;a>=0;a--)for(var l=r[a][o],f=a;f<o;f++)for(var s=r[a][f],c=r[f+1][o],p=0;p<s.symbols.length;p++){var h=s.symbols[p],m=this.lookupTable[h];if(m)for(var y=0;y<c.symbols.length;y++){var v=m[c.symbols[y]];if(v)for(var d=0;d<v.length;d++){var g=v[d];l.symbols.includes(g.defSymbol)||l.symbols.push(g.defSymbol),l.definitions.push(n({index:f},g))}}}return r},t.prototype.createBinaryTree=function(t){var e=this,r=this.performCYK(t),a=t.length-1;if(r[0][a].symbols=r[0][a].symbols.filter((function(t){return t==e.startSymbol})),0==r[0][a].symbols.length)return{error:!0,table:r};for(var o=function(t,e,n){return{cell:r[t][e],index:[t,e],symbol:n,node:null,pattern:null,left:null,right:null}},i=[o(0,a,this.startSymbol)],u=function(){var e=i[i.length-1],r=e.cell,a=e.index,u=a[0],l=a[1];if(u==l){i.pop();var f=r.definitions.find((function(t){return t.defSymbol==e.symbol}));if(e.node=n(n({},t[u]),f&&{pattern:f}),0==i.length)return{value:e.node}}else if(e.left){i.pop();s=e.left.node,c=e.right.node;if(e.node={symbol:e.pattern.defSymbol,left:s,right:c,pattern:e.pattern,range:{start:s.range.start,end:c.range.end},text:s.text+c.text},0==i.length)return{value:e.node}}else{f=e.pattern=r.definitions.find((function(t){return t.defSymbol==e.symbol}));var s=e.left=o(u,f.index,f.left),c=e.right=o(f.index+1,l,f.right);i.push(s,c)}};i.length>0;){var l=u();if("object"==typeof l)return l.value}},t}(),o=function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},i=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),a=0;for(e=0;e<r;e++)for(var o=arguments[e],i=0,u=o.length;i<u;i++,a++)n[a]=o[i];return n},u=0,l=function(){function t(t,e){this.grammar=t,this.startSymbol=e,this.CNF=this.createCNF(t,e)}return t.prototype.createCNF=function(t,e){var r=this.copyCFG(t);this.performBIN(r),this.performDEL(r),this.performUNIT(r);var n=Object.keys(r),i={};return n.forEach((function(t){var e=r[t];i[t]=e.map((function(t){return{left:t.parts[0],right:t.parts[1],metaData:o({},t.metaData)}}))})),new a(i,e)},t.prototype.copyCFG=function(t){var e={};return Object.keys(t).forEach((function(r){var n=t[r];e[r]=n.map((function(t){return function(t,e){return o(o({},t),{metaData:{orPattern:o(o({},t),{defSymbol:e})}})}(t,r)}))})),e},t.prototype.performBIN=function(t){for(var e=Object.keys(t),r=0;r<e.length;r++){var n=e[r],a=t[n];t[n]=a.map((function(r){if(r.parts.length>2){var n=u+++"";return t[n]=[o(o({},r),{parts:r.parts.slice(0,r.parts.length-1)})],e.push(n),o(o({},r),{parts:[n,r.parts[r.parts.length-1]],metaData:o(o({},r.metaData),{leftRecursive:!0})})}return r}))}},t.prototype.performDEL=function(t){var e=Object.keys(t),r=[],n={};e.forEach((function(e){var a=t[e];t[e]=a.filter((function(t){return 0==t.parts.length&&(n[e]=t.metaData),0!=t.parts.length})),a.length!=t[e].length&&r.push(e)}));for(var a=function(a){var i=r[a];e.forEach((function(e){for(var a=t[e],u=0;u<a.length;u++){var l=a[u],f=l.parts;f.length>1?(f[0]==i&&t[e].push({parts:[f[1]],metaData:o(o({},l.metaData),{leftEmpty:n[i]})}),f[1]==i&&t[e].push({parts:[f[0]],metaData:o(o({},l.metaData),{rightEmpty:n[i]})})):f[0]!=i||r.includes(e)||(r.push(e),n[e]=o(o({},l.metaData),l.metaData.leftEmpty?{rightEmpty:n[i]}:{leftEmpty:n[i]}))}}))},i=0;i<r.length;i++)a(i)},t.prototype.performUNIT=function(t){var e=Object.keys(t),r={};e.forEach((function(e){return r[e]=i(t[e])})),e.forEach((function(e){for(var n,a=t[e],i=0,u=function(t){var i=a[t];if(1==i.parts.length){var u=i.parts[0],l=r[u];if(u==e)return n=t,"continue";l?(l.forEach((function(t){return a.push(o(o({},t),{metaData:o(o({},t.metaData),{parent:i.metaData})}))})),a.splice(t,1),t--):a.splice(t,1,o(o({},i),i.metaData.orPattern&&{metaData:{parent:i.metaData,orPattern:void 0}}))}n=t},l=0;l<a.length&&i++<1e4;l++)u(l),l=n}))},t.prototype.createASTtree=function(t){var e=this.CNF.createBinaryTree(t);if("error"in e)return e;for(var r=function(t,e){return{text:"",range:{start:t,end:t},symbol:e.orPattern.defSymbol}},n=function(t,e,r){return{cnfNode:t,metaData:e||t.pattern&&t.pattern.metaData||{},children:r||[],range:t.range,initialized:!1}},a=[n(e)];a.length>0;){var u=a[a.length-1],l=u.cnfNode,f=u.metaData,s=u.children,c=u.initialized,p=u.range;if(c)if(!l||"left"in l||f.leftEmpty){a.pop();var h=s.map((function(t){return t.node}));f.leftRecursive&&h.splice.apply(h,i([0,1],h[0].children));var m=h[0].range.start,y=h[h.length-1].range.end,v=h.reduce((function(t,e){return t+e.text}),"");u.node={children:h,range:{start:m,end:y},text:v,pattern:f.orPattern,symbol:f.orPattern.defSymbol}}else a.pop(),u.node=o({range:l.range,text:l.text,symbol:l.symbol},f.orPattern&&{pattern:f.orPattern});else{if(u.initialized=!0,f.leftEmpty&&s.unshift(n(r(p.start,f.leftEmpty),f.leftEmpty)),l&&"left"in l&&(l.left&&s.push(n(l.left)),l.right&&s.push(n(l.right))),f.rightEmpty&&s.push(n(r(p.start,f.rightEmpty),f.rightEmpty)),f.parent){var d=o(o({},u),{metaData:o(o({},u.metaData),{parent:void 0})});u.children=[d],u.metaData=f.parent,delete u.cnfNode,u.initialized=!1,a.push(d)}a.push.apply(a,s)}if(0==a.length)return u.node}},t.walkTree=function(t,e){for(var r=function(t){return{node:t,result:null,children:null}},n=[r(t)];n.length>0;){var a=n[n.length-1],o=a.node;if("children"in o)if(a.children){if(n.pop(),a.result=e(o,a.children.map((function(t){return t.result}))),0==n.length)return a.result}else a.children=o.children.map((function(t){return r(t)})),n.push.apply(n,a.children);else if(a.result=e(o,[]),n.pop(),0==n.length)return a.result}},t}();var f=function(){function t(t){this.tokenizer=Object.keys(t).map((function(e){return[e,"string"==typeof t[e]?new RegExp((r=t[e],r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")),"y"):new RegExp(t[e],"y")];var r}))}return t.prototype.tokenize=function(t){var e=[],r=0;t:for(;;){for(var n=0;n<this.tokenizer.length;n++){var a=this.tokenizer[n],o=a[0],i=a[1];i.lastIndex=r;var u=i.exec(t);if(u){if(e.push({symbol:o,text:u[0],range:{start:r,end:r+u[0].length}}),r+=u[0].length,0==u[0].length){if(r==t.length)break;throw Error("Regex may not match 0 length strings: "+i+", use an empty pattern in the CFG instead")}continue t}}return r==t.length?e:{error:!0,index:r}}},t}(),s=function(){function t(t,e){this.interpreter=t,this.startSymbol=e,this.grammar=this.createCFG(t,e),this.tokenizer=this.createTokenizer(t)}return t.prototype.createCFG=function(t,e){var r={};return Object.keys(t.grammar).forEach((function(e){var n=t.grammar[e];r[e]=n.map((function(t){return{parts:t.parts,metaData:{eval:t.eval}}}))})),new l(r,e)},t.prototype.createTokenizer=function(t){var e={};return Object.keys(t.tokenizer).forEach((function(r){var n=t.tokenizer[r];e[r]="string"==typeof n?n:"match"in n?n.match:n})),new f(e)},t.prototype.evaluate=function(t,e){var r=this,n=this.tokenizer.tokenize(t);if("error"in n)return n;var a=this.grammar.createASTtree(n);return"error"in a?a:(e||(e={}),l.walkTree(a,(function(t,n){if("children"in t)return t.pattern.metaData.eval(n,e);var a=r.interpreter.tokenizer[t.symbol];return"string"!=typeof a&&"eval"in a?a.eval(t.text,a.match instanceof RegExp&&a.match.exec(t.text),e):t.text})))},t}(),c=function(){return(c=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},p=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),a=0;for(e=0;e<r;e++)for(var o=arguments[e],i=0,u=o.length;i<u;i++,a++)n[a]=o[i];return n},h=function(t){return"'"+t+"'"},m=new s({tokenizer:{sym:{match:/\s*\<([a-zA-Z0-9\-]+)\>\s*/,eval:function(t,e){return e[1]}},assign:/\s*::=\s*/,or:/\s*\|\s*/,text:{match:/"(([\\\\]|\\"|[^\\"])*)"|'(([\\\\]|\\'|[^\\'])*)'/,eval:function(t,e){return(e[1]||e[3]||"").replace(/\\"/,'"').replace(/\\'/,"'").replace(/\\\\/,"\\")}},eol:/\s*\r*\n|$/},grammar:{GRAMMAR:[{parts:["GRAMMAR","LINE"],eval:function(t){return t[0]}},{parts:["LINE"],eval:function(t,e){var r=t[0];return c({startSymbol:r},e)}}],LINE:[{parts:["sym","assign","DEF"],eval:function(t,e){var r=t[0],n=t[2];return e.grammar[r]=n,r}},{parts:["LINE","eol"],eval:function(t){return t[0]}},{parts:["eol"],eval:function(t){return t}}],DEF:[{parts:["DEF","or","SEQ"],eval:function(t){var e=t[0],r=t[2];return p(e,[r])}},{parts:["SEQ"],eval:function(t){return[t[0]]}}],SEQ:[{parts:["SEQ","MATCH"],eval:function(t){var e=t[0],r=t[1];return{parts:p(e.parts,[r])}}},{parts:["MATCH"],eval:function(t){return{parts:[t[0]]}}}],MATCH:[{parts:["text"],eval:function(t,e){var r=t[0],n='"'+r+'"',a=r.split("");return a.forEach((function(t){e.tokenizer[h(t)]=t})),e.grammar[n]=[{parts:a.map((function(t){return h(t)})),metaData:"word"}],n}},{parts:["sym"],eval:function(t,e){var r=t[0];return"eol"==r.toLowerCase()&&(e.tokenizer[r]=/\r*\n|$/),r}}]}},"GRAMMAR"),y=function(){function t(t){var e=this.createTokenizerAndCFG(t);if("error"in e)throw"index"in e?Error("Syntax error at index "+e.index):Error("Syntax error");this.CFG=e.grammar,this.tokenizer=e.tokenizer}return t.prototype.createTokenizerAndCFG=function(t){var e=m.evaluate(t,{tokenizer:{},grammar:{}});return"error"in e?e:{grammar:new l(e.grammar,e.startSymbol),tokenizer:new f(e.tokenizer)}},t.prototype.createASTtree=function(t){var e=this.tokenizer.tokenize(t);if("error"in e)return e;var r=this.CFG.createASTtree(e);return"error"in r?r:(l.walkTree(r,(function(t){"children"in t&&"word"==t.pattern.metaData&&(delete t.children,delete t.pattern)})),r)},t}();r.d(e,"CFG",(function(){return l})),r.d(e,"CNF",(function(){return a})),r.d(e,"Tokenizer",(function(){return f})),r.d(e,"Interpreter",(function(){return s})),r.d(e,"BNFinterpreter",(function(){return m})),r.d(e,"BNF",(function(){return y}))}])}));